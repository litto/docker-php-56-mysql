(function(c,b,a,d){c.widget("ui.finder",{options:{backButtonText:"Back",css:{active:"active",backButton:"ui-finder-backbutton",container:"ui-finder-container",dropContainer:"ui-finder-drop",dropListContainer:"ui-finder-drop-list",dropFooter:"ui-finder-drop-footer",input:"ui-finder-field",list:"ui-finder-list",listContainer:"ui-finder-list-container",listItem:"ui-finder-list-item",replaced:"ui-finder-select"},debug:false,divider:" > ",duration:300,easing:"linear",indent:"&nbsp;&nbsp;&nbsp;&nbsp;",maxHeight:150,valueAttribute:"data-finder-value",width:0,cache:{breadCrumbTrail:null,container:null,currentList:null,dropContainer:null,dropFooter:null,dropListContainer:null,listContainer:null,selectedItem:null}},_create:function(){var f=this,e=[];f._trigger("beforeLoad");f.options.width=parseInt(f.element.outerWidth());f.element.addClass(f.options.css.replaced).addClass("ui-helper-hidden-accessible");f.options.cache.container=c("<div></div>");f.options.cache.container.addClass(f.options.css.container).addClass("ui-widget").insertAfter(f.element);f.options.cache.breadCrumbTrail=c('<input type="text" readonly="readonly" />');f.options.cache.breadCrumbTrail.addClass(f.options.css.input).attr("name","_"+f.element.attr("name")).css("width",f.options.width).appendTo(f.options.cache.container);f._debug("Original width: ",f.options.width);f.options.cache.listContainer=c("<div></div>");f.options.cache.listContainer.addClass(f.options.css.listContainer).append(f._buildUL()).appendTo(f.options.cache.container);f.options.cache.dropContainer=c("<div></div>");f.options.cache.dropContainer.addClass(f.options.css.dropContainer).addClass("ui-helper-hidden-accessible").addClass("ui-corner-all").addClass("ui-widget-content").addClass("ui-menu").appendTo(f.options.cache.container);f.options.cache.dropListContainer=c("<div></div>");f.options.cache.dropListContainer.addClass(f.options.css.dropListContainer).css("height",f.options.maxHeight).appendTo(f.options.cache.dropContainer);f.options.cache.dropFooter=c("<div></div>");f.options.cache.dropFooter.addClass(f.options.css.dropFooter).append(c('<a href="#" />').text(f.options.backButtonText).addClass(f.options.css.backButton)).appendTo(f.options.cache.dropContainer);f.options.cache.listContainer.find("li").addClass("ui-menu-item");f.options.cache.listContainer.find("a").addClass("ui-corner-all").attr("tabindex","-1");f.options.cache.dropFooter.find("a").addClass("ui-state-default").addClass("ui-corner-all").attr("tabindex","-1");f.options.cache.listContainer.find("li").has("ul").each(function(g,h){c(this).children("a").append(c('<span class="ui-icon ui-icon-triangle-1-e"></span>'))});f.options.cache.selectedItem=f.options.cache.listContainer.find("a").filter(function(g){return(c(this).attr("href")==f.element.val())});if(!f.options.cache.selectedItem){f.options.cache.selectedItem=f.options.cache.listContainer.find("a:first")}f.options.cache.currentList=(f.options.cache.selectedItem.length)?f.options.cache.selectedItem.parent().parent():f.options.cache.listContainer.find("ul").eq(0);if(f.options.cache.selectedItem.length){f.options.cache.selectedItem.addClass("");f.options.cache.selectedItem.parentsUntil("div","a").andSelf().each(function(g,h){e.push(h.firstChild.textContent)});f.options.cache.breadCrumbTrail.val(e.join(f.options.divider))}f.options.cache.listContainer.find("a").on("click.finder",function(g){f.select(this);f.options.cache.dropListContainer.find("a").removeClass("ui-state-highlight");c(this).addClass("ui-state-highlight");return false}).on("mouseenter.finder mouseleave.finder",function(g){if(g.type=="mouseenter"){c(this).focus()}else{c(this).blur()}}).on("focusin.finder focusout.finder",function(g){if(g.type=="focusin"){c(this).addClass("ui-state-hover")}else{c(this).removeClass("ui-state-hover")}});f.options.cache.dropFooter.on("click.finder","a",function(g){g.preventDefault();f.previous();return false});f.options.cache.breadCrumbTrail.on("click.finder",function(g){g.preventDefault();c(this).focus();f.open();return false}).on("focusin.finder",function(g){g.preventDefault();f.open();return false});f._trigger("afterLoad")},open:function(){var g=this,h,f,e;c("."+g.options.css.replaced).finder("close");h=g.options.cache.currentList.clone(true);h.find("ul").remove();g.options.cache.dropListContainer.children().remove();h.appendTo(g.options.cache.dropListContainer);if(g.options.cache.currentList.parent().is("div")){g.options.cache.dropFooter.hide()}else{g.options.cache.dropFooter.show()}g._debug("Container width:",g.element.outerWidth());f=g.options.cache.breadCrumbTrail.width()+parseFloat(g.options.cache.breadCrumbTrail.css("borderLeftWidth"))+parseFloat(g.options.cache.breadCrumbTrail.css("borderRightWidth"));-parseFloat(g.options.cache.dropContainer.css("borderLeftWidth"))-parseFloat(g.options.cache.dropContainer.css("borderRightWidth"));g._debug("Dropdown width:",f);g.options.cache.dropListContainer.css("width",f);g.options.cache.dropContainer.css("width",f);e=(g.options.cache.dropFooter.is(":visible"))?g.options.maxHeight+g.options.cache.dropFooter.outerHeight():g.options.maxHeight;g.options.cache.dropContainer.removeClass("ui-helper-hidden-accessible").animate({height:e},100,g.options.easing,function(){});g.options.cache.dropListContainer.find("a:first").focus();c(a).on("click.finder",function(i){g.close()}).on("keydown.finder",function(i){var j=g.options.cache.dropListContainer.find("a:focus");switch(i.which){case 27:g.close();break;case 37:g.previous();break;case 13:case 39:g.options.cache.dropListContainer.find("a:focus").click();break;case 38:i.preventDefault();if(j.length){if(j.parent().prev().children("a").length){j.parent().prev().children("a").focus()}else{g.options.cache.dropListContainer.find("a:last").focus()}}else{g.options.cache.dropListContainer.find("a:first").focus()}break;case 40:i.preventDefault();if(j.length){if(j.parent().next().children("a").length){j.parent().next().children("a").focus()}else{g.options.cache.dropListContainer.find("a:first").focus()}}else{g.options.cache.dropListContainer.find("a:first").focus()}break}});g._trigger("onOpen")},close:function(){var e=this;e.options.cache.dropContainer.addClass("ui-helper-hidden-accessible");c(a).off("keydown.finder");e._trigger("onClose")},select:function(h){var i=this,g,f,e;i.options.cache.selectedItem=i.options.cache.listContainer.find("a").filter(function(j){return c(this).attr("href")==c(h).attr("href")});g=i.options.cache.dropListContainer.children("ul");if(!i.options.cache.selectedItem.siblings("ul").length){i._trigger("onBottomLevelSelection")}else{i._trigger("onTransitionStart");i.options.cache.currentList=i.options.cache.selectedItem.siblings("ul");i.options.cache.dropFooter.show();i.options.cache.dropContainer.css("height",i.options.maxHeight+i.options.cache.dropFooter.outerHeight());f=i.options.cache.currentList.clone(true).hide().appendTo(i.options.cache.dropListContainer);f.find("ul").remove();f.css({position:"absolute",top:"0px",left:i.options.cache.dropListContainer.outerWidth(),width:"100%",display:"block"});g.css({position:"absolute",top:"0px",left:"0px",width:"100%"});i.options.cache.dropListContainer.children().animate({left:"-="+i.options.cache.dropListContainer.outerWidth()},i.options.duration,i.options.easing,function(){g.remove();f.css({position:"relative",top:"auto",left:"auto",width:"auto"});i.options.cache.dropListContainer.find("a:first").focus();i._trigger("onTransitionComplete")})}i.element.val(i.options.cache.selectedItem.attr("href"));e=(i.options.cache.breadCrumbTrail.val()!="")?i.options.cache.breadCrumbTrail.val().split(i.options.divider):[];if(e.length==i.options.cache.selectedItem.parentsUntil("div","ul").length){e.pop()}e.push(i.options.cache.selectedItem[0].firstChild.textContent);i.options.cache.breadCrumbTrail.val(e.join(i.options.divider));i._debug("Selection: ",h);i._trigger("onSelect",null,{name:h.firstChild.textContent,value:c(h).attr("href"),element:h})},previous:function(){var i=this,g,f,e,h;if(i.options.cache.currentList.parent().is("div")){return false}e=i.options.cache.breadCrumbTrail.val().split(i.options.divider);h=i.options.cache.currentList.parentsUntil("div","ul");if(e.length>h.length){e=e.slice(0,e.length-(e.length-h.length))}i.options.cache.selectedItem=i.options.cache.currentList.parent();i.options.cache.currentList=i.options.cache.selectedItem.parent();g=i.options.cache.dropListContainer.children("ul");f=i.options.cache.selectedItem.parent().clone(true).hide().prependTo(i.options.cache.dropListContainer);f.find("ul").remove();f.css({position:"absolute",top:"0px",left:-i.options.cache.dropListContainer.outerWidth(),width:"100%",display:"block"});g.css({position:"absolute",top:"0px",left:"0px",width:"100%"});i._trigger("onTransitionStart");i.options.cache.dropListContainer.children().animate({left:"+="+i.options.cache.dropListContainer.outerWidth()},i.options.duration,i.options.easing,function(){g.remove();f.css({position:"relative",top:"auto",left:"auto",width:"auto"});i.options.cache.dropListContainer.find("a:first").focus();i._trigger("onTransitionComplete")});if(i.options.cache.currentList.parent().is("div")){i.options.cache.selectedItem=null;i.options.cache.dropFooter.hide();i.options.cache.dropContainer.css("height",i.options.maxHeight)}i.options.cache.breadCrumbTrail.val(e.join(i.options.divider));i._trigger("onGoBack")},destroy:function(){c.widget.prototype.destroy.call(this)},_buildUL:function(i){var h=this,g,e,f;i=(typeof i=="undefined")?this._buildDataStructure():i;g=c('<ul class="'+h.options.css.list+'"></ul>');c.each(i,function(j,k){e=c("<li></li>");f=c('<a href=""></a>');e.addClass(h.options.css.listItem).appendTo(g);f.attr("href",k.value).html(k.name).appendTo(e);if(k.children.length>0){e.append(h._buildUL(k.children))}});return g},_buildDataStructure:function(k,l){var j=this,e=[],h,g,f;k=(typeof k=="undefined")?j.element.find("option"):k;l=(typeof l=="undefined")?1:l;for(f=0;f<k.length;f++){option=k.eq(f);h=option.html().split(j.options.indent);g=option.next();if(h.length==l){e.push({name:h[h.length-1],value:option.attr("value"),children:j._buildDataStructure(option.nextAll(),l+1)})}if(g.length){if(g.html().split(j.options.indent).length<l){return e}}}return e},_debug:function(){if(this.options.debug){if(b.console){console.log(Array.prototype.slice.call(arguments))}}},_setOption:function(e,f){switch(e){case"open":this.open();break;case"close":this.close();break;default:this.options[e]=f;break}this._super("_setOption",e,f)}})})(jQuery,window,document);